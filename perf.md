# Как построить проект нагрузочного тестирования:

## Шаги:

Все перечисленные шаги не стоит рассматривать как step by step инструкцию.
Процесс планирования, реализации(создание инфраструцктуры, написание тестов) так и во многом проведения самого тестирования и анализ резулььтатов является итеративным. 

## 1. Анализ продукта для формирования требований и целей тестирования.
### 1.1 Анализ домена приложения(предметной области, функционала)
На этом шаге  определяются ключевые бизнес операции для тестирования производительности с последующей приоритезацией.
Приоритезация на данном этапе больше привязана к предметной области системы, ключевым операциям и их важности для бизнеса. Сама программная система на этом этапе рассматривается абстрактно. 
В качестве примера: Редактирование карты пацианта и отправка нотификации о резултьтате клинического тестирования.
Часто применяется термин KPI (Key Performance Indicator) но во многой литературе его относят скорее к анализу производительности самого тестирования или детализируют до выбора метрик(resonse time, latency).
Не исключено, что для продукта уже существуют декларативные не функциональные требования, например формальные значения максимальномго времени отклика, если таковые прописаны в контракте уже зарелиженного продукта. Такие данные могут пригодитьься при проведении сертификационного тестирования и должны быть проанализированы на данном этапе.
### 1.2 Изучение нагрузки на проде.
Изучается клиентский сетап по распределению нагрузки, стоит учитывать, что процесс нагрузочного тестирование может внедряться для продукта на активной стадии разработки и не иметь релиза, что возвращает к пункту о  изучение предметной области и забегапет на перед в область проведения  walkthrough (оценочного).
Для формирования профилей нагрузки важно изучить не только среднесуточные показатели , но и анализировать пиковаые всплески и их динамику, например за какой промежуток аремени от 100 конкурентных пользователей нагрузка может измениться до 300 и сколько может продлиться.
в зависимости от системы еще стоит обращать на распределние нагрузки по разным бизнес операциям, что важно в многокомпонентных сложных системах, в том числе в микросервисной архитектуре.
На этой стадии формируются рампы для лоада и опциоанально добавляются такие виды тестирования как walkthrough etc
### 1.3 Изучение архитектуры приложения и схемы иго деплоймента.
Важно учесть все компоненты как самой системы так и вспомогательных компнентов. Многие выводы из этого пункта повлияют на формирование конечной workload модели и созднаие тестового станда(ов).
 - Платформа(Kubenetes, Docker-compose, VM)
 - Enterprise Level Architecure(монолит, микросевис, наличие и протокол очередей, datasouurces: бд, object storages, hardware instruments)
 - Наличие Service mesh, Load Balancer(s)
### 1.4 Изучение процесса тестирования и разработки на продукте.
На данном шаге изучается существующая инфраструктура. Важные аспекты:
- CI/CD (Какая платформа используется, проводится ли инструментальное, интеграционное или функциональное тестирование).
  Важно для дальнейшей интеграции в существующую схему Performfnce тестирование и определение его итераций.
- Анализ APM. Умеет ли приложение или его (какие) компоненты предоставлять сови Performfnce метрики, если да, то насколько гранулярны, есть ли для них манифест.
- Налаиче HW метрик, Observability инфраструктуры. (Важно для последующего сбора резцльтатов)
- Тулсет

## 2. Создание тестовой среды.
По сути представляет собой макимально приближенную к клиентским конфигурацию.
Аппаратная составляющая(CPU/RAM etc) чаще всего будет отмасштабирована с оглядкой на клиентский сетап. Но программаная конфигурация должна быть максчимально приближена к клиентской. 
Контейнеризация в настоящее время во многом помогает задеплоить приложение с теми же зависимостями как и на проде.
Но речь идёт больше о  настройке роутинга, лоад балансера, брокеров очередей, если приложение может работать на нескольких базах, то стоит либо иметь несколько стендов, либюо иметь быструю возможность переключаться между датасорсами.
Важный момент: наличие исторических данных, например для регрешен тестирования можно использовать базу с одинаковым набором данных, но для сертификационного лоада, наличе историчесих данных важно, так как может выявить проблемы с неправльно настроенными индексами и тд.
Сам процесс может быть тоже итератиным, например при определении стартовых требований при walthrough тестинге появляются стартолвые данные о Hardware efficiency.

## 3. Формирование тест плана
 - Формализация тестовой платформы, тестируемых бизнес операций и их приоритетов при создании тест кейсов(как правило распредлеляются на майлстоуны)(Test Scope)
 - Требования: определение KPI по каждой операции согласно принятой математической модели, персентили, коэфиуиент вариации и тд. Формализация правил по созднаию перформанс дефектов.
 - Определение видов тестирования end2end, API Load, Throughput, Stress , Endurance.
   Пример тест плана:
## Test Scope	
   ### Scenarios
   ### Limitations and not tested features
## Test Approach
   ### Testing methodology
   ### Test Resulting and Control
      #### Results  analysis
      #### Performance Issues.
   ### Reporting	
## Test Environment and workload model
   ### Model environment (HW, DB)
   ### Load distribution
   ### Risks and Assumptions
   ### Test Schedule
## Test tools	
Addendum  - Business operations

## 4. Написание тестов и формирование тестовой ифраструктуры.
- Определение вида отчёта о тестировании. Включает в себя не только отчёт по каждой бизнес операции на каждой рампе, но ещё важно включаеть его достаточность с точки зрения наличия сводных дашбоард  с APM/HW/DB логгирования. Цель обеспечить максимум информации для исправления перформнс дефектов. 
  Наличие информации о перформанс деградации, как по задержке так и по HW Efficiency.
  Из опыта: KIbana dashboard с метаданномы по каждому тест ранц, в котором KPI по кажой бизнес операции, референсит на Grafana с детализацией по временой шкале и дополнительными APM/HW/DB метриками.
- Выьор туллсетв. Зависит от предыдущих щагов, архитектуры(какой API, тестируем ли латенси форонта, десктопа, мобильных приложений) и существующей инфраструктуры: CI/CD интеграцией с уже используемым инструментарием.
- Написание тестов. Должно быть итеративным и как можно быстрее попадать в CI. чем быстрее попадёт в CI, тем быстрее начнут накаплаиваться исторические данные для анализа/
## 5. выполнение тестов
## 6. Анализ результатов
## 7. Корректировка и повторное тестирование
## 8. Документирование результатов

